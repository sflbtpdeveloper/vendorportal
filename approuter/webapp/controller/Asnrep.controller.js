sap.ui.define(["zmmsubcontract/controller/BaseController","sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/Dialog","sap/m/CheckBox","sap/m/Button","sap/m/VBox","sap/m/HBox"],function(e,t,n,o,r,i,a,s,l){"use strict";return e.extend("zmmsubcontract.controller.Asnrep",{onInit:function(){debugger;this._dialog=null;this._localModel=this.getOwnerComponent().getModel("poservice");this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("SupASNRep").attachPatternMatched(this._onRouteMatched,this);this._userModel=this.getOwnerComponent().getModel("userModel");let e=localStorage.getItem("userInfo");if(e){let t=JSON.parse(e);this._userModel.setProperty("/",{email:t.email,user:t.user,scopes:t.scopes})}},_onRouteMatched:function(){this._readData()},onBeforeRendering:function(){if(this.oRouter){this.oRouter.getRoute("SupASNRep").detachPatternMatched(this._onRouteMatched,this)}},onAfterRendering:function(){this.oRouter.getRoute("SupASNRep").attachPatternMatched(this._onRouteMatched,this)},_readData:function(){debugger;this.byId("searchFieldAsnno").setValue("");this.byId("searchFieldEbeln").setValue("");this.byId("searchFieldMatnr").setValue("");this.byId("searchFieldMaktx").setValue("");var e=this.getOwnerComponent().getModel("poservice");e.refreshMetadata();e.refresh(true);this.getView().byId("asnTable").setModel(e);var t=this;sap.ui.core.BusyIndicator.show(0);this.getOwnerComponent().setModel(e,"poservice");this._userModel=this.getOwnerComponent().getModel("userModel");let n=this._userModel.oData.email;let o=[new sap.ui.model.Filter("Email",sap.ui.model.FilterOperator.EQ,n)];this.fetchASNReport(n)},onEbeln:function(e){debugger;this._applyFilters()},onAsnno:function(e){debugger;this._applyFilters()},onMatnr:function(e){debugger;this._applyFilters()},onMaktx:function(e){debugger;this._applyFilters()},jobstatff:function(e){if(e){return e==="C"?"/images/GTICK.jpg":"/images/RCROSS.jpg"}return e},PayText:function(e){if(e==="P"){return"Completed"}else if(e==="NP"){return"Pending"}return" "},PayState:function(e){if(e==="P"){return"Success"}else if(e==="NP"){return"Error"}return"None"},PayIcon:function(e){if(e==="P"){return"sap-icon://accept"}else if(e==="NP"){return"sap-icon://decline"}return""},conditionalText:function(e){if(e==="0000000000"||e==="0000"||!e){return""}return e},isGrnoNonEmpty:function(e){return!!(e&&e.trim()!=="")},_applyFilters:function(){var e=[];var t=this.byId("searchFieldAsnno").getValue();var r=this.byId("searchFieldEbeln").getValue();var i=this.byId("searchFieldMatnr").getValue();var a=this.byId("searchFieldMaktx").getValue();if(t){e.push(new n("Asnno",o.Contains,t))}if(r){e.push(new n("Ebeln",o.Contains,r))}if(i){e.push(new n("Matnr",o.Contains,i))}if(a){e.push(new n("Maktx",o.Contains,a))}console.log("Applied filters:",e);var s=this.byId("asnTable");var l=s.getBinding("rows");if(l){if(e.length>0){var u=new n({filters:e,and:true});l.filter(u)}else{l.filter([])}}},onSelectColumnsPress:function(){debugger;if(!this._dialog){this._dialog=new r({title:"Select Columns",content:this._createColumnSelectionContent(),draggable:true,beginButton:new a({text:"OK",press:function(){this._dialog.close()}.bind(this)}),afterClose:function(){this._dialog.destroy();this._dialog=null}.bind(this)})}this._dialog.open()},_createColumnSelectionContent:function(){debugger;var e=new s;var t=[{id:"_IDGenColumn1",label:"ASN Number"},{id:"_IDGenColumn2",label:"ASN Item"},{id:"_IDGenColumn3",label:"PO Number"},{id:"_IDGenColumn4",label:"PO Item"},{id:"_IDGenColumn5",label:"Material Number"},{id:"_IDGenColumn6",label:"Material Description"},{id:"_IDGenColumn7",label:"DC Number"},{id:"_IDGenColumn8",label:"DC Date"},{id:"_IDGenColumn9",label:"Asn Qty"},{id:"_IDGenColumn10",label:"Asn Status"},{id:"_IDGenColumn11",label:"DMRR Number"},{id:"_IDGenColumn12",label:"GR Number"},{id:"_IDGenColumn13",label:"IR Number"},{id:"_IDGenColumn14",label:"Payment Status"},{id:"_IDGenColumn15",label:"Payment Reference"}];var n=new l({justifyContent:"SpaceBetween"});var o=new a({text:"Select All",press:function(){t.forEach(function(e){var t=this.byId("asnTable").getColumns().find(t=>t.getId().endsWith(e.id));if(t){t.setVisible(true)}},this);this._updateCheckBoxes(e,true)}.bind(this)});var r=new a({text:"Deselect All",press:function(){t.forEach(function(e){var t=this.byId("asnTable").getColumns().find(t=>t.getId().endsWith(e.id));if(t){t.setVisible(false)}},this);this._updateCheckBoxes(e,false)}.bind(this)});n.addItem(o);n.addItem(r);e.addItem(n);t.forEach(function(t){var n=this.byId("asnTable").getColumns().find(e=>e.getId().endsWith(t.id));if(n){var o=new i({selected:n.getVisible(),text:t.label,select:function(e){var t=e.getParameter("selected");n.setVisible(t)}});e.addItem(o)}},this);return e},_updateCheckBoxes:function(e,t){e.getItems().forEach(function(e){if(e instanceof sap.m.CheckBox){e.setSelected(t)}})},onDownloadExcel:function(){var e=this.byId("asnTable");var t=this.getView().getModel("asnRep");var n=t.getProperty("/");if(!n||n.length===0){sap.m.MessageBox.error("No records found to download.");return}var o=n.map(function(e){return{"ASN Number":e.Asnno,"Item Number":e.Posnr,"PO Number":e.Ebeln,"PO Item":e.Ebelp,Material:e.Matnr,Desc:e.Maktx,"DC No":e.Dcno,"DC Date":e.Dcdate,"ASN Qty":e.Asnqty,"ASN Status":e.Asnstatus,"DMRR No":e.Dmrrno,"GRN No":e.Mblnr,"IR No":e.Mblnr1,"Payment Status":e.Pstatus,"Payment Ref":e.Pcomplete}});var r=this.convertToCsv(o);var i=new Blob([r],{type:"text/csv;charset=utf-8;"});var a=document.createElement("a");var s=URL.createObjectURL(i);a.setAttribute("href",s);a.setAttribute("download","supplier_data.csv");a.style.visibility="hidden";document.body.appendChild(a);a.click();document.body.removeChild(a)},convertToCsv:function(e){var t="";var n=Object.keys(e[0]);t+=n.join(",")+"\r\n";e.forEach(function(e){t+=n.map(function(t){return e[t]?e[t].toString().replace(/,/g," "):""}).join(",")+"\r\n"});return t},_downloadCSV:function(e,t){var n=new Blob([e],{type:"text/csv;charset=utf-8;"});var o=document.createElement("a");var r=URL.createObjectURL(n);o.setAttribute("href",r);o.setAttribute("download",t);document.body.appendChild(o);o.click();document.body.removeChild(o);URL.revokeObjectURL(r)},fetchASNReport:async function(e){debugger;const t=this;sap.ui.core.BusyIndicator.show();try{const n=await $.ajax({url:"/nodeapp/ASNReport",method:"GET",contentType:"application/json",data:{email:e}});sap.ui.core.BusyIndicator.hide();const o=n;debugger;const r=new sap.ui.model.json.JSONModel(o);t.getView().setModel(r,"asnRep")}catch(e){sap.ui.core.BusyIndicator.hide();console.error("Error fetching ASN Report Data:",e);const t=e.responseJSON?.error?.innererror?.errordetails?.[0]?.message||"Unknown error occurred"}}})});
//# sourceMappingURL=Asnrep.controller.js.map
sap.ui.define(["zmmsubcontract/controller/BaseController","sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/Dialog","sap/m/CheckBox","sap/m/Button","sap/m/VBox","sap/m/HBox"],function(e,t,n,r,a,o,i,s,l){"use strict";return e.extend("zmmsubcontract.controller.Asnrep",{onInit:function(){debugger;this._dialog=null;this._localModel=this.getOwnerComponent().getModel("poservice");this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("SupASNRep").attachPatternMatched(this._onRouteMatched,this);this._userModel=this.getOwnerComponent().getModel("userModel");let e=localStorage.getItem("userInfo");if(e){let t=JSON.parse(e);this._userModel.setProperty("/",{email:t.email,user:t.user,scopes:t.scopes})}},_onRouteMatched:function(){this._readData()},onBeforeRendering:function(){if(this.oRouter){this.oRouter.getRoute("SupASNRep").detachPatternMatched(this._onRouteMatched,this)}},onAfterRendering:function(){this.oRouter.getRoute("SupASNRep").attachPatternMatched(this._onRouteMatched,this)},_readData:function(){debugger;this.byId("searchFieldAsnno").setValue("");this.byId("searchFieldEbeln").setValue("");this.byId("searchFieldMatnr").setValue("");this.byId("searchFieldMaktx").setValue("");var e=this.getOwnerComponent().getModel("poservice");e.refreshMetadata();e.refresh(true);this.getView().byId("asnTable").setModel(e);var t=this;sap.ui.core.BusyIndicator.show(0);this.getOwnerComponent().setModel(e,"poservice");this._userModel=this.getOwnerComponent().getModel("userModel");let n=this._userModel.oData.email;let r=[new sap.ui.model.Filter("Email",sap.ui.model.FilterOperator.EQ,n)];this.fetchASNReport(n)},onEbeln:function(e){debugger;this._applyFilters()},onAsnno:function(e){debugger;this._applyFilters()},onMatnr:function(e){debugger;this._applyFilters()},onMaktx:function(e){debugger;this._applyFilters()},jobstatff:function(e){if(e){return e==="C"?"/images/GTICK.jpg":"/images/RCROSS.jpg"}return e},PayText:function(e){if(e==="P"){return"Completed"}else if(e==="NP"){return"Pending"}return" "},PayState:function(e){if(e==="P"){return"Success"}else if(e==="NP"){return"Error"}return"None"},PayIcon:function(e){if(e==="P"){return"sap-icon://accept"}else if(e==="NP"){return"sap-icon://decline"}return""},conditionalText:function(e){if(e==="0000000000"||e==="0000"||!e){return""}return e},isGrnoNonEmpty:function(e){return!!(e&&e.trim()!==""&&e!=="0000000000")},_applyFilters:function(){var e=[];var t=this.byId("searchFieldAsnno").getValue();var a=this.byId("searchFieldEbeln").getValue();var o=this.byId("searchFieldMatnr").getValue();var i=this.byId("searchFieldMaktx").getValue();if(t){e.push(new n("Asnno",r.Contains,t))}if(a){e.push(new n("Ebeln",r.Contains,a))}if(o){e.push(new n("Matnr",r.Contains,o))}if(i){e.push(new n("Maktx",r.Contains,i))}console.log("Applied filters:",e);var s=this.byId("asnTable");var l=s.getBinding("rows");if(l){if(e.length>0){var u=new n({filters:e,and:true});l.filter(u)}else{l.filter([])}}},onFromAsnDateChange:function(e){this.applyFilters1()},onToAsnDateChange:function(e){this.applyFilters1()},applyFilters1:function(){var e=this.byId("asnTable");if(!e){console.warn("Table not found!");return}var t=e.getBinding("rows");if(!t){console.warn("Table binding not found!");return}var n=this.byId("fromAsnDate").getDateValue();var r=this.byId("toAsnDate").getDateValue();var a=[];if(n&&!r){var o=this.formatDateToYYYYMMDD(n);a.push(new sap.ui.model.Filter("Asndate1",sap.ui.model.FilterOperator.EQ,o))}else if(n&&r){var o=this.formatDateToYYYYMMDD(n);var i=this.formatDateToYYYYMMDD(r);a.push(new sap.ui.model.Filter("Asndate1",sap.ui.model.FilterOperator.BT,o,i))}if(a.length>0){t.filter(a,"Application")}else{t.filter([])}console.log("Applied Filters:",a)},formatDateToYYYYMMDD:function(e){if(!e)return null;var t=e.getFullYear();var n=String(e.getMonth()+1).padStart(2,"0");var r=String(e.getDate()).padStart(2,"0");return t+n+r},onSelectColumnsPress:function(){debugger;if(!this._dialog){this._dialog=new a({title:"Select Columns",content:this._createColumnSelectionContent(),draggable:true,beginButton:new i({text:"OK",press:function(){this._dialog.close()}.bind(this)}),afterClose:function(){this._dialog.destroy();this._dialog=null}.bind(this)})}this._dialog.open()},_createColumnSelectionContent:function(){debugger;var e=new s;var t=[{id:"_IDGenColumn1",label:"ASN Number"},{id:"_IDGenColumn2",label:"ASN Item"},{id:"_IDGenColumn3",label:"PO Number"},{id:"_IDGenColumn4",label:"PO Item"},{id:"_IDGenColumn5",label:"Material Number"},{id:"_IDGenColumn6",label:"Material Description"},{id:"_IDGenColumn7",label:"DC Number"},{id:"_IDGenColumn8",label:"DC Date"},{id:"_IDGenColumn9",label:"Asn Qty"},{id:"_IDGenColumn10",label:"Asn Status"},{id:"_IDGenColumn11",label:"DMRR Number"},{id:"_IDGenColumn12",label:"GR Number"},{id:"_IDGenColumn13",label:"IR Number"},{id:"_IDGenColumn14",label:"Payment Status"},{id:"_IDGenColumn15",label:"Payment Reference"},{id:"_IDGenColumn17",label:"Accepted Quantity"},{id:"_IDGenColumn18",label:"Rejected Quantity"}];var n=new l({justifyContent:"SpaceBetween"});var r=new i({text:"Select All",press:function(){t.forEach(function(e){var t=this.byId("asnTable").getColumns().find(t=>t.getId().endsWith(e.id));if(t){t.setVisible(true)}},this);this._updateCheckBoxes(e,true)}.bind(this)});var a=new i({text:"Deselect All",press:function(){t.forEach(function(e){var t=this.byId("asnTable").getColumns().find(t=>t.getId().endsWith(e.id));if(t){t.setVisible(false)}},this);this._updateCheckBoxes(e,false)}.bind(this)});n.addItem(r);n.addItem(a);e.addItem(n);t.forEach(function(t){var n=this.byId("asnTable").getColumns().find(e=>e.getId().endsWith(t.id));if(n){var r=new o({selected:n.getVisible(),text:t.label,select:function(e){var t=e.getParameter("selected");n.setVisible(t)}});e.addItem(r)}},this);return e},_updateCheckBoxes:function(e,t){e.getItems().forEach(function(e){if(e instanceof sap.m.CheckBox){e.setSelected(t)}})},onDownloadExcel:function(){var e=this.byId("fromAsnDate").getDateValue();var t=this.byId("toAsnDate").getDateValue();var n=this.byId("asnTable");var r=n.getBinding("items");var a=this.getView().getModel("asnRep");var o=a.getProperty("/");if(e&&!t){var i=this.formatDateToYYYYMMDD(e);o=o.filter(function(e){return e.Asndate1===i})}else if(e&&t){var i=this.formatDateToYYYYMMDD(e);var s=this.formatDateToYYYYMMDD(t);o=o.filter(function(e){return e.Asndate1>=i&&e.Asndate1<=s})}if(!o||o.length===0){sap.m.MessageBox.error("No records found to download.");return}var l=o.map(function(e){return{"ASN Number":e.Asnno,"Item Number":e.Posnr,"PO Number":e.Ebeln,"PO Item":e.Ebelp,Material:e.Matnr,Desc:e.Maktx,"DC No":e.Dcno,"DC Date":e.Dcdate,"ASN Qty":e.Asnqty,"ASN Status":e.Asnstatus,"DMRR No":e.Dmrrno,"GRN No":e.Mblnr,"IR No":e.Mblnr1,"Payment Status":e.Pstatus,"Payment Ref":e.Pcomplete,"Accepted Quantity":e.Accqty,"Rejected Quantity":e.Rejqty}});var u=this.convertToCsv(l);var d=new Blob([u],{type:"text/csv;charset=utf-8;"});var c=document.createElement("a");var h=URL.createObjectURL(d);c.setAttribute("href",h);c.setAttribute("download","supplier_data.csv");c.style.visibility="hidden";document.body.appendChild(c);c.click();document.body.removeChild(c)},convertToCsv:function(e){var t="";var n=Object.keys(e[0]);t+=n.join(",")+"\r\n";e.forEach(function(e){t+=n.map(function(t){return e[t]?e[t].toString().replace(/,/g," "):""}).join(",")+"\r\n"});return t},_downloadCSV:function(e,t){var n=new Blob([e],{type:"text/csv;charset=utf-8;"});var r=document.createElement("a");var a=URL.createObjectURL(n);r.setAttribute("href",a);r.setAttribute("download",t);document.body.appendChild(r);r.click();document.body.removeChild(r);URL.revokeObjectURL(a)},fetchASNReport:async function(e){debugger;const t=this;sap.ui.core.BusyIndicator.show();try{const n=await $.ajax({url:"/nodeapp/ASNReport",method:"GET",contentType:"application/json",data:{email:e}});sap.ui.core.BusyIndicator.hide();const r=n;debugger;const a=new sap.ui.model.json.JSONModel(r);t.getView().setModel(a,"asnRep")}catch(e){sap.ui.core.BusyIndicator.hide();console.error("Error fetching ASN Report Data:",e);const t=e.responseJSON?.error?.innererror?.errordetails?.[0]?.message||"Unknown error occurred"}}})});
//# sourceMappingURL=Asnrep.controller.js.map
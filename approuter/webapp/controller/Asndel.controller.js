sap.ui.define(["zmmsubcontract/controller/BaseController","sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox"],function(e,t,r,o,n){"use strict";return t.extend("zmmsubcontract.controller.Asndel",{formatDateToISO:function(e){var t=new Date(e);var r=t.getFullYear();var o=String(t.getMonth()+1).padStart(2,"0");var n=String(t.getDate()).padStart(2,"0");var s=String(t.getHours()).padStart(2,"0");var a=String(t.getMinutes()).padStart(2,"0");var i=String(t.getSeconds()).padStart(2,"0");return`${r}-${o}-${n}T${s}:${a}:${i}`},onInit:function(){debugger;this._localModel=this.getOwnerComponent().getModel("poservice");this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("SupASNDel").attachPatternMatched(this._onRouteMatched,this);this._userModel=this.getOwnerComponent().getModel("userModel");let e=localStorage.getItem("userInfo");if(e){let t=JSON.parse(e);this._userModel.setProperty("/",{email:t.email,user:t.user,scopes:t.scopes})}},_readData:function(){debugger;this.getView().byId("_IDGenSearchField2").setValue("");this.getView().byId("_IDGenSearchField1").setValue("");this.getView().byId("_IDGenSearchField3").setValue("");var e=this.getOwnerComponent().getModel("poservice");e.refreshMetadata();e.refresh(true);this.getView().byId("asndelTable").setModel(e);var t=this;sap.ui.core.BusyIndicator.show(0);this.getOwnerComponent().setModel(e,"poservice");this._userModel=this.getOwnerComponent().getModel("userModel");let r=this._userModel.oData.email;let o=[new sap.ui.model.Filter("Email",sap.ui.model.FilterOperator.EQ,r)];this.fetchSupASNDel(r)},onBeforeRendering:function(){if(this.oRouter){this.oRouter.getRoute("SupASNDel").detachPatternMatched(this._onObjectMatched,this)}},onAfterRendering:function(){if(this.oRouter){this.oRouter.getRoute("SupASNDel").attachPatternMatched(this._onObjectMatched,this)}},_onRouteMatched:function(e){this._readData()},onAsnno:function(e){debugger;this._applyFilters()},onWerks:function(e){debugger;this._applyFilters()},onDcno:function(e){debugger;this._applyFilters()},_applyFilters:function(){var e=[];var t=this.byId("_IDGenSearchField2").getValue();var n=this.byId("_IDGenSearchField1").getValue();var s=this.byId("_IDGenSearchField3").getValue();if(t){e.push(new r("Asnno",o.Contains,t))}if(n){e.push(new r("Werks",o.Contains,n))}if(s){e.push(new r("Dcno",o.Contains,s))}var a=new r({filters:e,and:true});var i=this.byId("asndelTable");var l=i.getBinding("items");if(l){l.filter(a)}},onToggleButtonPress:function(e){debugger;var t=e.getSource();var r=t.getPressed();var o=this.byId("asndelTable");var s=o.getSelectedItems();if(s.length===0){n.error("Please select at least one item to delete.");return}var a=this.getView().getModel("poservice");var i=s.map(function(e){var t=e.getBindingContext("asnDel");var r=t.getObject();return{Asnno:r.Asnno||"",Lifnr:r.Lifnr||"",Werks:r.Werks||"",Dcno:r.Dcno||"",Dcdate:this.formatDateToISO(r.Dcdate)||"",Menge:r.Menge||"",Zpack:r.Zpack||"",Asnweight:r.Asnweight||"",Lrdate:r.Lrdate||"",Lrnumber:r.Lrnumber||"",Vechileno:r.Vechileno||"",Grstatus:r.Grstatus||"",Dmrrstatus:r.Dmrrstatus||"",Asnstatus:r.Asnstatus||""}},this);i.forEach(e=>{debugger;var t="/YMM_SUPPLIER_PO_ASN_DELSet"+"(Asnno='"+e.Asnno+"')";a.remove(t,{method:"DELETE",success:e=>{debugger;this._localModel=this.getOwnerComponent().getModel("poservice");this._readData();n.success("Item deleted successfully.")},error:e=>{n.error("Error deleting item.");console.error(e)}})})},fetchSupASNDel:async function(e){debugger;const t=this;sap.ui.core.BusyIndicator.show();try{const r=await $.ajax({url:"/nodeapp/SupASNDel",method:"GET",contentType:"application/json",data:{email:e}});sap.ui.core.BusyIndicator.hide();const o=r;debugger;const n=new sap.ui.model.json.JSONModel(o);t.getView().setModel(n,"asnDel")}catch(e){sap.ui.core.BusyIndicator.hide();console.error("Error fetching ASN Report Data:",e);const t=e.responseJSON?.error?.innererror?.errordetails?.[0]?.message||"Unknown error occurred"}}})});
//# sourceMappingURL=Asndel.controller.js.map
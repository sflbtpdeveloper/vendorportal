sap.ui.define(["zmmsubcontract/controller/BaseController","sap/ui/core/Popup","sap/m/Popover","sap/m/VBox","sap/m/Label","sap/m/Button","sap/m/GenericTile","sap/m/MessageBox","sap/ui/core/Fragment","jquery.sap.global"],function(e,t,o,s,i,n,a,r,d,jQuery){"use strict";return e.extend("zmmsubcontract.controller.subcon",{onInit:function(){debugger;this.startSessionTimeout();this._userModel=this.getOwnerComponent().getModel("userModel");let t=this;fetch("/getUserInformation").then(e=>e.json()).then(e=>{t._userModel.setProperty("/",{email:e.email,user:e.user,scopes:e.scopes});localStorage.setItem("userInfo",JSON.stringify(e));console.log(t._userModel.getProperty("/"))}).catch(e=>console.log(e));var o=this.byId("idCars2");setInterval(function(){var e=o.getPages();var t=o.getActivePage();var s=-1;e.forEach(function(e,o){if(e.getId()===t){s=o}});var i=(s+1)%e.length;o.setActivePage(e[i].getId())},4e3);e.prototype.onInit.apply(this);this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("RouteView1").attachPatternMatched(this._onObjectMatched,this);var s=this.getView().byId("popover");this._bInsidePopover=true;this._localModel=this.getOwnerComponent().getModel("local");this._homeModel=this.getOwnerComponent().getModel("home");this._SupSerModel=this.getOwnerComponent().getModel("SupSer");this._SubSerModel=this.getOwnerComponent().getModel("SubSer");this._VenOnbModel=this.getOwnerComponent().getModel("VenOnb");this._qisModel=this.getOwnerComponent().getModel("qis");this._TrnVenModel=this.getOwnerComponent().getModel("TrnVen");this._CrDrModel=this.getOwnerComponent().getModel("CrDr");this._ncrModel=this.getOwnerComponent().getModel("ncr");this._SupRatModel=this.getOwnerComponent().getModel("SupRat");this._circModel=this.getOwnerComponent().getModel("circ");this._dashModel=this.getOwnerComponent().getModel("dash");var i=this.getView().byId("idIconTabBar");var n=this;i.getItems().forEach(function(e){e.addEventDelegate({onmouseover:function(t){n.onIconTabFilterHover(t,e)},onmouseout:function(t){n.onIconTabFilterOut(t,e)}})});s.attachAfterOpen(function(){var e=s.getDomRef();if(e){e.addEventListener("mouseover",this.onPopoverMouseOver.bind(this));e.addEventListener("mouseout",this.onPopoverMouseOut.bind(this))}}.bind(this));var a=this.byId("idLEmail");a.addEventDelegate({onmouseover:this.onEmailHover.bind(this),onmouseout:this.onEmailMouseOut.bind(this)})},_onObjectMatched:function(){this.oRouter.getRoute("RouteView1").detachPatternMatched(this._onObjectMatched,this)},onTabClick:function(e,t){if(sap.ui.Device.system.phone||sap.ui.Device.system.tablet){debugger;var o=this.getView().byId("idIconTabBar");var s=this._localModel;var i=this._homeModel;var n=this._SubSerModel;var a=this._SupSerModel;var r=this._VenOnbModel;var d=this._qisModel;var l=this._TrnVenModel;var c=this._CrDrModel;var u=this._ncrModel;var h=this._SupRatModel;var p=this._circModel;var g=this._dashModel;var b=this.getView().byId("popover");var v=this;switch(o.mProperties.selectedKey){case"id_Home":v.getView().byId("idList").setModel(i,"localData");break;case"id_SupSer":v.getView().byId("idList").setModel(a,"localData");break;case"id_SubSer":v.getView().byId("idList").setModel(n,"localData");break;case"id_VenOnb":v.getView().byId("idList").setModel(r,"localData");break;case"id_Qis":v.getView().byId("idList").setModel(d,"localData");break;case"id_trVen":v.getView().byId("idList").setModel(l,"localData");break;case"id_CrDbNt":v.getView().byId("idList").setModel(c,"localData");break;case"id_Ncr":v.getView().byId("idList").setModel(u,"localData");break;case"id_SupRt":v.getView().byId("idList").setModel(h,"localData");break;case"id_Cir":v.getView().byId("idList").setModel(p,"localData");break;case"id_Dash":v.getView().byId("idList").setModel(g,"localData");break;default:oList.setModel(null)}var M=[];o.getItems().forEach(function(e){var t=e.getDomRef();if(t&&t.offsetParent!==null){M.push(e)}});var f=o.mProperties.selectedKey;var m=M.find(function(e){return e.getKey()===f});if(m){o.setSelectedKey(f);this._bInsidePopover=true;b.openBy(m)}}},onIconTabFilterHover:function(e,t){var o=this.getView().byId("idIconTabBar");var s=this._localModel;var i=this._homeModel;var n=this._SubSerModel;var a=this._SupSerModel;var r=this._VenOnbModel;var d=this._qisModel;var l=this._TrnVenModel;var c=this._CrDrModel;var u=this._ncrModel;var h=this._SupRatModel;var p=this._circModel;var g=this._dashModel;var b=this.getView().byId("popover");var v=this;switch(t.mProperties.key){case"id_Home":v.getView().byId("idList").setModel(i,"localData");break;case"id_SupSer":v.getView().byId("idList").setModel(a,"localData");break;case"id_SubSer":v.getView().byId("idList").setModel(n,"localData");break;case"id_VenOnb":v.getView().byId("idList").setModel(r,"localData");break;case"id_Qis":v.getView().byId("idList").setModel(d,"localData");break;case"id_trVen":v.getView().byId("idList").setModel(l,"localData");break;case"id_CrDbNt":v.getView().byId("idList").setModel(c,"localData");break;case"id_Ncr":v.getView().byId("idList").setModel(u,"localData");break;case"id_SupRt":v.getView().byId("idList").setModel(h,"localData");break;case"id_Cir":v.getView().byId("idList").setModel(p,"localData");break;case"id_Dash":v.getView().byId("idList").setModel(g,"localData");break;default:oList.setModel(null)}var M=[];o.getItems().forEach(function(e){var t=e.getDomRef();if(t&&t.offsetParent!==null){M.push(e)}});var f=t.mProperties.key;var m=M.find(function(e){return e.getKey()===f});if(m){o.setSelectedKey(t.getKey());this._bInsidePopover=true;b.openBy(m)}},onIconTabFilterOut:function(e,t){var o=this.getView().byId("popover");this._bInsidePopover=false;setTimeout(function(){if(!this._bInsidePopover){o.close()}}.bind(this),1e3)},onTabSelect:function(e){},onPopoverMouseOver:function(e){this._bInsidePopover=true},onPopoverMouseOut:function(){var e=this.getView().byId("popover");this._bInsidePopover=false;setTimeout(function(){if(!this._bInsidePopover){e.close()}}.bind(this),100)},onSubconDA:function(){debugger;if(!data.scopes||!data.scopes.includes("getuserinfo!t10709.read")){this.oRouter.navTo("unAuth")}else{this.oRouter.navTo("subconDA")}},OnCreateASN:function(){this.oRouter.navTo("subconASNcr")},onPress:function(e){var t=e.oSource.mProperties.title;const o=this._userModel.getProperty("/");if(t==="DA schedule"){this.oRouter.navTo("subconDA")}else if(t==="ASN Create"){this.oRouter.navTo("RegASN")}else if(t==="ASSEMBLY ASN"){this.oRouter.navTo("AsseASN")}else if(t==="ASN Report"){this.oRouter.navTo("asnrep")}else if(t==="ASN Status"){this.oRouter.navTo("asnstat")}else if(t==="ASN Delete"){this.oRouter.navTo("asndel")}else if(t==="ASN Print"){this.oRouter.navTo("asnprint")}else if(t==="PO Schedules"){this.oRouter.navTo("PoSchedule")}else if(t==="Create ASN"){this.oRouter.navTo("SupAsnCrt")}else if(t==="Supplier ASN Report"){this.oRouter.navTo("SupASNRep")}else if(t==="Delete ASN"){this.oRouter.navTo("SupASNDel")}else{}},onAboutUsPress:function(){window.open("https://sundram.com/about-us.php","_blank")},onContactsPress:function(){window.open("https://sundram.com/contact-us.php","_blank")},onEmailHover:function(e){debugger;var t=this.getView();var o=e.srcControl;if(!this._vendordetails){d.load({id:t.getId(),name:"zmmsubcontract.fragments.vendordetails",controller:this}).then(function(e){t.addDependent(e);this._vendordetails=e;this._loadVendorDetails(o);this._vendordetails.openBy(o)}.bind(this))}else{this._loadVendorDetails(o);this._vendordetails.openBy(o)}},_loadVendorDetails:function(e){this._userModel=this.getOwnerComponent().getModel("userModel");var t=this._userModel.getProperty("/email");this.fetchVendor(t)},fetchVendor:async function(e){debugger;const t=this;sap.ui.core.BusyIndicator.show();try{const s=await $.ajax({url:"/nodeapp/vendor",method:"GET",contentType:"application/json",data:{email:e}});sap.ui.core.BusyIndicator.hide();const i=s;debugger;var o=new sap.ui.model.json.JSONModel(i);o.setData(i[0]);t._vendordetails.setModel(o,"vendorModel")}catch(e){sap.ui.core.BusyIndicator.hide()}},onEmailMouseOut:function(){if(this._vendordetails){this._vendordetails.close()}},onLogOut:async function(){debugger;const e=await this.getCsrfToken("/nodeapp/custom/logout");$.ajax({type:"POST",url:"/nodeapp/custom/logout",headers:{"X-CSRF-Token":e,"Content-Type":"application/json"},success:function(e){window.location.href=e},error:function(e,t,o){console.error("Logout failed:",o);console.log("Response status:",e.status);console.log("Response text:",e.responseText)}})},getCsrfToken:function(e){return new Promise(function(t,o){$.ajax({type:"GET",url:e,headers:{"X-CSRF-Token":"fetch","Content-Type":"application/json"},success:function(e,o,s){const i=s.getResponseHeader("X-CSRF-Token");debugger;t(i)},error:function(e,t,s){console.error("Failed to fetch CSRF token:",s);o(s)}})})},startSessionTimeout:function(){const e=18e6;let t;const o=()=>{clearTimeout(t);t=setTimeout(()=>{this.onSessionTimeout()},e)};document.addEventListener("mousemove",o);document.addEventListener("keydown",o);o()},onSessionTimeout:function(){sap.m.MessageToast.show("Session has expired due to inactivity.");this.onLogOut()}})});
//# sourceMappingURL=subcon.controller.js.map
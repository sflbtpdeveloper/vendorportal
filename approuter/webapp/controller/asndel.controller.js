sap.ui.define(["zmmsubcontract/controller/BaseController","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/core/date/UI5Date","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/PDFViewer"],function(e,t,r,n,a,o,s,i,d){"use strict";return e.extend("zmmsubcontract.controller.asndel",{_data:{dtValue:o.getInstance(),dtPattern:undefined},onInit:function(){e.prototype.onInit.apply(this);this._localModel=this.getOwnerComponent().getModel("local");this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("asndel").attachPatternMatched(this._onObjectMatched,this);this._userModel=this.getOwnerComponent().getModel("userModel");let t=localStorage.getItem("userInfo");if(t){let e=JSON.parse(t);this._userModel.setProperty("/",{email:e.email,user:e.user,scopes:e.scopes})}this.oRouter=this.getOwnerComponent().getRouter()},onBeforeRendering:function(){if(this.oRouter){this.oRouter.getRoute("asndel").detachPatternMatched(this._onObjectMatched,this)}},onAfterRendering:function(){if(this.oRouter){this.oRouter.getRoute("asndel").attachPatternMatched(this._onObjectMatched,this)}},_readData:function(){this.getView().byId("idFilPlant2").setValue("");this.getView().byId("idFilASN2").setValue("");this.getView().byId("idFilVen2").setValue("");this.getView().byId("searchField2").setValue("");var e=this.getOwnerComponent().getModel("asncrt");this.getView().byId("idasnDel").setModel(e);var t=this;sap.ui.core.BusyIndicator.show(0);this.getOwnerComponent().setModel(e,"defaultModel");this._userModel=this.getOwnerComponent().getModel("userModel");let r=this._userModel.oData.email;this.fetchASNdel(r)},onRowSelect:function(){alert("Triggered")},onVendor:function(e){this._applySearchFilter("Lifnr",e.getParameter("query"))},_onObjectMatched:function(e){this._readData()},onASN:function(e){this._applySearchFilter("Asnno",e.getParameter("query"))},onPlant:function(e){this._applySearchFilter("Werks",e.getParameter("query"))},onInv:function(e){this._applySearchFilter("Ebeln",e.getParameter("query"))},_applySearchFilter:function(e,t){var r=[];if(t&&t.length>0){var n=new s(e,i.Contains,t);r.push(n)}var a=this.byId("idDetail");var o=a.getBinding("items");o.filter(r,"Application")},formatDate:function(e){if(e){var t=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"dd-MM-yyyy"});return t.format(new Date(e))}return e},_selectedData:function(e){var r=this.getView();var n=r.byId("idasnDel");var a=n.getSelectedItems();var o=[];if(a.length===0){debugger;t.error("Please Enter at least one Record");return}var s=a.map(function(e){return e.getBindingContext("asnrepModel")});var i=s.map(function(e){return e.getProperty("Asnno")});o.push(i);this._deleteRecords(o,i,s,a)},_deleteRecords:function(e,t,r,n){debugger;var a=this.getOwnerComponent().getModel("asncrt");var o=this.getView();var s=o.byId("idasnDel");var i=this;sap.ui.core.BusyIndicator.show(0);a.setUseBatch(true);var d="deleteBatchGroup";a.setDeferredGroups([d]);debugger;var u=t.map(function(e){return new Promise(function(t,r){var n="/ZET_ASN_CRTSet('"+e+"')";a.remove(n,{groupId:d,success:function(){debugger;t()},error:function(e){debugger;sap.m.MessageBox.error(errorMessage||"An unexpected error occurred.");r(e)}})})});a.submitChanges({groupId:d,success:function(e){Promise.all(u).then(function(){debugger;i._readData();sap.m.MessageBox.success("Records deleted successfully.")}).catch(function(){debugger;sap.m.MessageBox.error("Error deleting records.")}).finally(function(){sap.ui.core.BusyIndicator.hide()})},error:function(e){sap.m.MessageBox.error("Batch request failed.");sap.ui.core.BusyIndicator.hide()}})},onDeleteASN:function(e){this._selectedData(e)},onASN:function(e){debugger;var t=e.getParameter("newValue");var r=this.byId("idasnDel");var n=r.getBinding("items");var a=[];if(t&&t.length>0){var o=new s("Asnno",i.Contains,t);a.push(new s({filters:[o],and:false}))}n.filter(a)},onPlant:function(e){debugger;var t=e.getParameter("newValue");var r=this.byId("idasnDel");var n=r.getBinding("items");var a=[];if(t&&t.length>0){var o=new s("Werks",i.Contains,t);a.push(new s({filters:[o],and:false}))}n.filter(a)},onInv:function(e){debugger;var t=e.getParameter("newValue");var r=this.byId("idasnDel");var n=r.getBinding("items");var a=[];if(t&&t.length>0){var o=new s("Ebeln",i.Contains,t);a.push(new s({filters:[o],and:false}))}n.filter(a)},onVendor:function(e){debugger;var t=e.getParameter("newValue");var r=this.byId("idasnDel");var n=r.getBinding("items");var a=[];if(t&&t.length>0){var o=new s("Lifnr",i.Contains,t);a.push(new s({filters:[o],and:false}))}n.filter(a)},fetchASNdel:async function(e){debugger;const t=this;sap.ui.core.BusyIndicator.show();try{const r=await $.ajax({url:"/nodeapp/asndelete",method:"GET",contentType:"application/json",data:{email:e}});sap.ui.core.BusyIndicator.hide();const n=r;debugger;const a=new sap.ui.model.json.JSONModel(n);t.getView().setModel(a,"asnrepModel")}catch(e){sap.ui.core.BusyIndicator.hide();console.error("Error fetching ASN Status Records:",e);const t=e.responseJSON?.error?.innererror?.errordetails?.[0]?.message||"Unknown error occurred"}}})});
//# sourceMappingURL=asndel.controller.js.map
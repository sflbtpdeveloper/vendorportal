sap.ui.define(["zmmsubcontract/controller/BaseController","sap/ui/core/mvc/Controller","sap/m/PDFViewer","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,r,i,s,o){"use strict";return e.extend("zmmsubcontract.controller.List",{onInit:function(){debugger;e.prototype.onInit.apply(this);this._localModel=this.getOwnerComponent().getModel("poservice");this.oRouter.getRoute("PoSchedule").attachPatternMatched(this._onObjectMatched,this);this.oRouter=this.getOwnerComponent().getRouter();this._userModel=this.getOwnerComponent().getModel("userModel");let t=localStorage.getItem("userInfo");if(t){let e=JSON.parse(t);this._userModel.setProperty("/",{email:e.email,user:e.user,scopes:e.scopes})}},_onObjectMatched:function(e){this._refreshView()},_refreshView:function(){this._readData()},_readData:function(){this.getView().byId("searchFieldWerks").setValue("");this.getView().byId("searchFieldEbeln").setValue("");this.getView().byId("searchFieldMatnr").setValue("");this.getView().byId("searchFieldMaktx").setValue("");this._userModel=this.getOwnerComponent().getModel("userModel");var e=this._userModel.getProperty("/email");let t=[new sap.ui.model.Filter("Email",sap.ui.model.FilterOperator.EQ,e)];var r=this.getOwnerComponent().getModel("poservice");r.refreshMetadata();r.refresh(true);this.getView().byId("myCustomTable").setModel(r);var i=this;sap.ui.core.BusyIndicator.show(0);this.getOwnerComponent().setModel(r,"poservice");this.fetchSupplierPO(e)},onEbeln:function(e){debugger;this._applyFilters()},onWerks:function(e){debugger;this._applyFilters()},onMatnr:function(e){debugger;this._applyFilters()},onMaktx:function(e){debugger;this._applyFilters()},_applyFilters:function(){var e=[];var t=this.byId("searchFieldWerks").getValue();var r=this.byId("searchFieldEbeln").getValue();var o=this.byId("searchFieldMatnr").getValue();var n=this.byId("searchFieldMaktx").getValue();if(t){e.push(new i("Werks",s.Contains,t))}if(r){e.push(new i("Ebeln",s.Contains,r))}if(o){e.push(new i("Matnr",s.Contains,o))}if(n){e.push(new i("Maktx",s.Contains,n))}var a=this.byId("myCustomTable");var l=a.getBinding("items");if(l){if(e.length>0){if(!Array.isArray(e)){console.error("Filters is not an array:",e);return}var d=new i({filters:e,and:true});l.filter(d)}else{l.filter([])}}},onButtonPress:function(e){debugger;var t=e.getSource();var r=t.getParent();var i=r.getBindingContext("listModel");var s=i.getObject();if(s.Pdfchk==="X"){sap.m.MessageBox.error("Selected PO has No print Preview")}else{var o="pdfViewer-"+(new Date).getTime();var n=new sap.m.PDFViewer({id:o});this.getView().addDependent(n);var a=this.getView();var l=a.getModel();var d=this.getView().getModel("pdf").sServiceUrl;var u=d+"/get_pdfSet('"+s.Ebeln+"')/$value";n.setSource(u);n.setTitle("My PDF");n.open()}},_fetchPDF:function(e,t){fetch(e,{method:"HEAD"}).then(function(e){if(e.ok){t(true)}else{t(false)}}).catch(function(e){t(false)})},fetchSupplierPO:async function(e){debugger;const t=this;sap.ui.core.BusyIndicator.show();try{const r=await $.ajax({url:"/nodeapp/supplierPO",method:"GET",contentType:"application/json",data:{email:e}});sap.ui.core.BusyIndicator.hide();const i=r;debugger;const s=new sap.ui.model.json.JSONModel(i);t.getView().setModel(s,"listModel")}catch(e){sap.ui.core.BusyIndicator.hide();console.error("Error fetching DA List:",e);const t=e.responseJSON?.error?.innererror?.errordetails?.[0]?.message||"Unknown error occurred"}}})});
//# sourceMappingURL=List.controller.js.map
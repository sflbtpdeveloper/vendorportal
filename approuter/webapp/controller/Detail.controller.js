sap.ui.define(["zmmsubcontract/controller/BaseController","sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox"],function(e,t,r,o,a){"use strict";return e.extend("zmmsubcontract.controller.Detail",{onInit:function(){e.prototype.onInit.apply(this);debugger;this._localModel=this.getOwnerComponent().getModel("poservice");this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("SupAsnCrt").attachPatternMatched(this._onObjectMatched,this);this._userModel=this.getOwnerComponent().getModel("userModel");let t=localStorage.getItem("userInfo");if(t){let e=JSON.parse(t);this._userModel.setProperty("/",{email:e.email,user:e.user,scopes:e.scopes})}},onBeforeRendering:function(){if(this.oRouter){this.oRouter.getRoute("SupAsnCrt").detachPatternMatched(this._onObjectMatched,this)}},onAfterRendering:function(){this.oRouter.getRoute("SupAsnCrt").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){this._readData()},_readData:function(){this.byId("searchFieldWerks").setValue("");this.byId("searchFieldEbeln").setValue("");this.byId("searchFieldMatnr").setValue("");this.byId("searchFieldMaktx").setValue("");this._userModel=this.getOwnerComponent().getModel("userModel");var e=this._userModel.getProperty("/email");let t=[new sap.ui.model.Filter("Email",sap.ui.model.FilterOperator.EQ,e)];var r=this.getOwnerComponent().getModel("poservice");r.refreshMetadata();r.refresh(true);this.getView().byId("detailTab").setModel(r);var o=this;sap.ui.core.BusyIndicator.show(0);this.getOwnerComponent().setModel(r,"poservice");this.fetchDetail(e)},onEbeln:function(e){debugger;this._applyFilters()},onWerks:function(e){debugger;this._applyFilters()},onMatnr:function(e){debugger;this._applyFilters()},onMaktx:function(e){debugger;this._applyFilters()},_applyFilters:function(){var e=[];var t=this.byId("searchFieldWerks").getValue();var a=this.byId("searchFieldEbeln").getValue();var n=this.byId("searchFieldMatnr").getValue();var s=this.byId("searchFieldMaktx").getValue();if(t){e.push(new r("Werks",o.Contains,t))}if(a){e.push(new r("Ebeln",o.Contains,a))}if(n){e.push(new r("Matnr",o.Contains,n))}if(s){e.push(new r("Maktx",o.Contains,s))}var i=this.byId("detailTab");var l=i.getBinding("items");if(l){if(e.length>0){if(!Array.isArray(e)){console.error("Filters is not an array:",e);return}var d=new r({filters:e,and:true});l.filter(d)}else{l.filter([])}}},onToggleButtonPress:function(e){debugger;var t=this.byId("detailTab");var r=t.getSelectedItems();if(r.length===0){a.error("No items selected. Please select at least one item.");return}else{var o=r.map(function(e){return e.getBindingContext("detailModel").getObject()});var n=r[0].getBindingContext("detailModel");var s=n.getProperty("Ebeln");var i=n.getProperty("Ebelp");var l=r.every(function(e){var t=e.getBindingContext("detailModel");if(t){var r=t.getProperty("Ebeln");var o=t.getProperty("Ebelp");return r===s}return false});if(!l){a.error("Please select records with the same PO Number.");return}debugger;var d=new sap.ui.model.json.JSONModel;d.setData(o);localStorage.removeItem("asnItemsData");localStorage.removeItem("lineItemsData");localStorage.setItem("asnItemsData",JSON.stringify(o));this.getOwnerComponent().setModel(d,"asnItems");var u=this.getOwnerComponent().getRouter();u.navTo("Asn",{},false)}},fetchDetail:async function(e){debugger;const t=this;sap.ui.core.BusyIndicator.show();try{const r=await $.ajax({url:"/nodeapp/supplierPODetail",method:"GET",contentType:"application/json",data:{email:e}});sap.ui.core.BusyIndicator.hide();const o=r;debugger;const a=new sap.ui.model.json.JSONModel(o);t.getView().setModel(a,"detailModel");t.getView().byId("detailTab").setModel(a,"detailModel")}catch(e){sap.ui.core.BusyIndicator.hide();console.error("Error fetching DA List:",e);const t=e.responseJSON?.error?.innererror?.errordetails?.[0]?.message||"Unknown error occurred"}},_applyHighlighting:function(){var e=this.getView().byId("detailTab");if(!e){console.error("Table not found!");return}var t=e.getItems();t.forEach((e,t)=>{var r=e.getBindingContext("detailModel");if(!r){console.warn(`No binding context for row ${t}`);return}var o=r.getProperty("POP");console.log(`Row ${t} POP Value:`,o);var a=e.getCells()[3];if(o==="X"){a.addStyleClass("highlightText")}else{a.addStyleClass("boldtext")}})}})});
//# sourceMappingURL=Detail.controller.js.map
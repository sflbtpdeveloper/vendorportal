sap.ui.define(["zmmsubcontract/controller/BaseController","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/core/date/UI5Date","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/PDFViewer"],function(e,t,r,n,a,o,i,s,d){"use strict";return e.extend("zmmsubcontract.controller.asnprint",{_data:{dtValue:o.getInstance(),dtPattern:undefined},onInit:function(){e.prototype.onInit.apply(this);this.oRouter=this.getOwnerComponent().getRouter();this._localModel=this.getOwnerComponent().getModel("local");this.oRouter.getRoute("asnprint").attachPatternMatched(this._onObjectMatched,this);debugger;this._userModel=this.getOwnerComponent().getModel("userModel");let t=localStorage.getItem("userInfo");if(t){let e=JSON.parse(t);this._userModel.setProperty("/",{email:e.email,user:e.user,scopes:e.scopes})}this.oRouter=this.getOwnerComponent().getRouter()},onBeforeRendering:function(){if(this.oRouter){this.oRouter.getRoute("asnprint").detachPatternMatched(this._onObjectMatched,this)}},onAfterRendering:function(){this.oRouter.getRoute("asnprint").attachPatternMatched(this._onObjectMatched,this)},_readData:function(){this.getView().byId("idFilPlant3").setValue("");this.getView().byId("idFilASN3").setValue("");this.getView().byId("idFilVen3").setValue("");this.getView().byId("searchField3").setValue("");this._userModel=this.getOwnerComponent().getModel("userModel");var e=this._userModel.getProperty("/email");let r=[new sap.ui.model.Filter("Email",sap.ui.model.FilterOperator.EQ,e)];var n=this.getOwnerComponent().getModel("asncrt");this.getView().byId("idasn").setModel(n);var a=this;sap.ui.core.BusyIndicator.show(0);this.getOwnerComponent().setModel(n,"defaultModel");this.fetchASNPrint(e);n.read("/ZET_ASN_CRTSet",{filters:r,success:function(e,t){debugger;sap.ui.core.BusyIndicator.hide();var r=new sap.ui.model.json.JSONModel;r.setData(e.results);a.getView().setModel(r,"asnrepModel")},error:function(e){debugger;console.log(e);sap.ui.core.BusyIndicator.hide();t.error(JSON.parse(e.responseText).error.innererror.errordetails[0].message)}})},onRowSelect:function(){alert("Triggered")},onSearchVendor:function(e){this._applySearchFilter("Lifnr",e.getParameter("query"))},_onObjectMatched:function(e){this._readData()},onSearchVendor:function(e){this._applySearchFilter("Lifnr",e.getParameter("query"))},onSearchWerks:function(e){this._applySearchFilter("Werks",e.getParameter("query"))},_applySearchFilter:function(e,t){var r=[];if(t&&t.length>0){var n=new i(e,s.Contains,t);r.push(n)}var a=this.byId("idDetail");var o=a.getBinding("items");o.filter(r,"Application")},_selectedData:function(e){debugger;var t=e.getParameter("listItem");var r=t.getBindingContext("default");var n=r.getProperty("Lifnr");var a=r.getProperty("Werks");var o=r.getProperty("Op_matnr");var i=r.getProperty("Ip_Matnr");var s=r.getProperty("Maktx");var d=r.getProperty("Meins");var l=r.getProperty("Balqty");var u=r.getProperty("bprme");var c=r.getProperty("Exnum");var g={};g.vendor=n;g.plant=a;g.outputmat=o;g.inputmat=i;g.desc=s;g.uom=d;g.balqty=l;g.bprme=u;g.dano=c;var p=new sap.ui.model.json.JSONModel;p.setData(g);this.getOwnerComponent().setModel(p,"ASNMODEL")},captureRecordEH:function(e){this._selectedData(e);debugger;this.displayCrtAsnEH()},displayCrtAsnEH:function(){this.oRouter.navTo("subconASNcr")},onPreviewPDF:function(e){debugger;var t=e.getSource();var r=t.getBindingContext("asnrepModel");var n=r.getObject();var a=this.getView();var o=this.getOwnerComponent().getModel("asncrt");var i=new d;this.getView().addDependent(i);var s=o.sServiceUrl;var l="/zasnpdfSet(Asnno='"+n.Asnno+"')/$value";var u=s+"/zasnpdfSet(Asnno='"+n.Asnno+"')/$value";i.setSource(u);i.setTitle("DA PDF");i.open()},onASN:function(e){debugger;var t=e.getParameter("newValue");var r=this.byId("idasn");var n=r.getBinding("items");var a=[];if(t&&t.length>0){var o=new i("Asnno",s.Contains,t);a.push(new i({filters:[o],and:false}))}n.filter(a)},onPlant:function(e){debugger;var t=e.getParameter("newValue");var r=this.byId("idasn");var n=r.getBinding("items");var a=[];if(t&&t.length>0){var o=new i("Werks",s.Contains,t);a.push(new i({filters:[o],and:false}))}n.filter(a)},onInv:function(e){debugger;var t=e.getParameter("newValue");var r=this.byId("idasn");var n=r.getBinding("items");var a=[];if(t&&t.length>0){var o=new i("Ebeln",s.Contains,t);a.push(new i({filters:[o],and:false}))}n.filter(a)},onVendor:function(e){debugger;var t=e.getParameter("newValue");var r=this.byId("idasn");var n=r.getBinding("items");var a=[];if(t&&t.length>0){var o=new i("Lifnr",s.Contains,t);a.push(new i({filters:[o],and:false}))}n.filter(a)},fetchASNPrint:async function(e){debugger;const t=this;sap.ui.core.BusyIndicator.show();try{const r=await $.ajax({url:"/nodeapp/asndelete",method:"GET",contentType:"application/json",data:{email:e}});sap.ui.core.BusyIndicator.hide();const n=r;debugger;const a=new sap.ui.model.json.JSONModel(n);t.getView().setModel(a,"asnrepModel")}catch(e){sap.ui.core.BusyIndicator.hide();console.error("Error fetching ASN Status Records:",e);const t=e.responseJSON?.error?.innererror?.errordetails?.[0]?.message||"Unknown error occurred"}}})});
//# sourceMappingURL=asnprint.controller.js.map